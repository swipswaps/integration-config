- project:
    name: cergen
    jobs:
        - '{name}-tox-docker':
            # FIXME: Can't use 0.2.0 due to T212395
            docker_image_var: docker-registry.wikimedia.org/releng/tox-cergen:0.4.0

- project:
    name: acme-chief
    jobs:
        - '{name}-tox-docker':
            docker_image_var: docker-registry.wikimedia.org/releng/tox-acme-chief:0.3.4

- project:
    name: conftool
    jobs:
        - '{name}-tox-docker':
            docker_image_var: docker-registry.wikimedia.org/releng/tox-conftool:0.4.0

- job:
    name: 'operations-dns-lint-docker'
    node: Docker
    triggers:
        - zuul
    builders:
        - docker-run:
            image: docker-registry.wikimedia.org/releng/operations-dnslint:0.0.6
    publishers:
        - docker-cleanup

- job-template:
    name: 'operations-mw-config-{phpflavor}-composer-{run-script}-docker'
    node: Docker
    triggers:
        - zuul
    builders:
        - docker-castor-load
        - docker-log-dir
        - docker-src-dir
        - docker-ci-src-setup-simple
        # Install solely the require-dev dependencies (T85947)
        - docker-run-with-log-cache-src:
            image: '{image}'
            options: '--entrypoint=/srv/composer/composer-install-dev-only'
            args: '/src --profile --ignore-platform-reqs'
            logdir: '/log'
        # Now in /src, just run composer test
        - docker-run-with-log-cache-src:
            image: '{image}'
            args: '--ansi --working-dir=/src {run-script}'
            logdir: '/log'
    publishers:
        - archive-log-allow-empty
        - castor-save-workspace-cache
        - docker-cleanup

- project:
    name: 'operations-mw-config'
    phpflavor:
     - php72:
         image: docker-registry.wikimedia.org/releng/composer-php72:0.2.2
    jobs:
     - '{name}-typos-docker'
     - 'operations-mw-config-{phpflavor}-composer-{run-script}-docker':
         run-script:
             - lint
             - test
             - diffConfig

- project:
    name: 'cassandra-table-properties'
    jobs:
        - '{name}-tox-docker':
            docker_image_var: docker-registry.wikimedia.org/releng/tox-pywikibot:0.4.0
            build_timeout: 20 # minutes

- project:
    name: 'cumin'
    jobs:
        - '{name}-tox-docker':
            build_timeout: 20 # minutes
            docker_image_var: docker-registry.wikimedia.org/releng/tox:0.4.0
        - tox-publish-jobs:
            docenv: 'py37-sphinx'
            docsrc: 'doc/build/html'
            docdest: 'cumin/$DOC_SUBPATH'
            docker_image_var: docker-registry.wikimedia.org/releng/tox:0.4.0

- project:
    name: docker-pkg
    jobs:
        - '{name}-tox-publish':
            docsrc: 'doc/build'
            docdest: 'docker-pkg'

- project:
    name: 'homer'
    jobs:
        - '{name}-tox-docker':
            docker_image_var: docker-registry.wikimedia.org/releng/tox-homer:0.1.0
        - tox-publish-jobs:
            docenv: 'py36-sphinx'
            docsrc: 'doc/build/html'
            docdest: 'homer/$DOC_SUBPATH'
            docker_image_var: docker-registry.wikimedia.org/releng/tox-homer:0.1.0

- project:
    name: netbox-reports
    jobs:
        - '{name}-tox-docker'

- project:
    name: 'spicerack'
    jobs:
        - tox-publish-jobs:
            docenv: 'py36-sphinx'
            docsrc: 'doc/build/html'
            docdest: 'spicerack/$DOC_SUBPATH'

- job:
    name: 'helm-lint'
    node: Docker
    triggers:
     - zuul
    builders:
     - docker-src-dir
     - docker-ci-src-setup-simple
     - docker-run-with-log-cache-src:
         image: docker-registry.wikimedia.org/releng/helm-linter:0.2.0
         logdir: '/log'
    publishers:
     - docker-cleanup
