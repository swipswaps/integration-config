- publisher:
    name: email-wikidata-ci-status
    publishers:
     - email-ext:
         recipients: wikidata-ci-status@wikimedia.de
         attach-build-log: true
         first-failure: true
         aborted: true
         failure: false
         fixed: true
- job-template:
    name: '{name}-release-silent'
    project-type: maven
    node: DebianJessie
    concurrent: false

    jdk: 'Debian - OpenJdk 8'
    parameters:
      - string:
          name: 'GIT_URL'
          default: 'ssh://{git-user}@gerrit.wikimedia.org:29418'
      - string:
          name: 'GIT_PROJECT'
          default: '{release-project}'
      - string:
          name: 'GIT_BRANCH'
          default: '{release-branch}'
      - string:
          name: 'GIT_REF'
          default: '{release-branch}'
      - string:
          name: 'GIT_COMMIT'
          default: '{release-branch}'

    scm:
      - git:
          url: '$GIT_URL/$GIT_PROJECT'
          branches:
            - '$GIT_BRANCH'
          local-branch: '$GIT_BRANCH'
          git-config-name: '{git-user}'
          git-config-email: '{git-user-email}'

    wrappers:
      - timeout:
          timeout: 30
          fail: true
      - maven-release:
          release-goals:
            -Dresume=false -Duser.name='{git-user}' -Djdk.net.URLClassPath.disableClassPathURLCheck=true release:prepare release:perform
          dry-run-goals:
            -Dresume=false -Duser.name='{git-user}' -Djdk.net.URLClassPath.disableClassPathURLCheck=true -DdryRun=true release:prepare
          num-successful-builds: 1
      - ssh-agent-credentials:
          users:
            - '{git-user-id}'

    maven:
      goals: clean package
      settings:
        'org.jenkinsci.plugins.configfiles.maven.MavenSettingsConfig.ArchivaCredentialsSettings'

- project:
    name: wikidata-query-gui
    jobs:
      - '{name}-npm-browser-node-6-docker':
          docker_image_var: docker-registry.wikimedia.org/releng/npm-browser-test:0.5.0

- project:
    name: wikidata-query-rdf
    git-user: maven-release-user
    git-user-email: maven-release-user@wikimedia.org
    git-user-id: maven-release-user
    release-project: wikidata/query/rdf
    release-branch: master
    jar-update-project: wikidata/query/rdf
    jar-update-branch: master
    jobs:
      - '{name}-maven-java8-docker':
          docker_image_var: docker-registry.wikimedia.org/releng/java8-wikidata-query-rdf:0.3.1
      - '{name}-maven-java8-docker-site-publish':
          docker_image_var: docker-registry.wikimedia.org/releng/java8-wikidata-query-rdf:0.3.1
      - '{name}-release-silent'


- project:
    name: wikidata-query-blazegraph
    jobs:
      - '{name}-maven-java8-docker':
          timeout: 180  # Blazegraph tests are long

- project:
    name: analytics-wmde-toolkit-analyzer
    jobs:
        - '{name}-maven-java8-docker':
            maven_args: --file analyzer/pom.xml test

- project:
    name: wikibase-daily-npm-audit
    repository: mediawiki/extensions/Wikibase
    jobs:
     - '{name}-daily-node10-npmaudit-docker':
#        recipients:
#         - email-wikidata-ci-status
